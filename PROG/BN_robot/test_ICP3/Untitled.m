% Generate model points
clear all;
clc;
a = readtable('graphXY0V.csv');
b = table2array(a);
c = b(1,:);
%model(1,:) = c(~isinf(c));
c = b(2,:);
%model(2,:) = c(~isinf(c));
data = [1035 0;
1461 25;
1915 66;
1919 100;
1921 134;
1925 168;
1956 205;
990 121;
532 103;
533 113;
533 123;
522 130;
485 130;
443 127;
470 143;
512 166;
497 171;
470 171;
594 228;
447 180;
450 191;
453 201;
446 208;
442 215;
438 223;
435 231;
432 239;
430 248;
428 257;
426 266;
423 275;
397 268;
353 247;
428 311;
394 297;
353 276;
341 276;
330 277;
319 277;
307 277;
296 276;
286 276;
277 277;
267 276;
257 276;
248 276;
240 276;
232 276;
224 276;
216 276;
208 276;
201 276;
193 276;
186 276;
179 275;
172 276;
165 276;
159 276;
153 276;
146 276;
140 276;
134 275;
128 276;
123 276;
117 276;
111 276;
106 277;
100 277;
95 277;
90 277;
85 278;
79 277;
74 278;
69 278;
64 278;
59 278;
54 279;
49 279;
44 279;
39 279;
34 279;
29 280;
24 279;
19 279;
14 279;
0 321;
-4 280;
-9 280;
-14 280;
-19 281;
-24 282;
-29 285;
-35 289;
-46 265;
-54 280;
-59 278;
-64 277;
-68 274;
-71 268;
-74 260;
-87 286;
-93 289;
-100 291;
-104 286;
-107 281;
-113 280;
-119 280;
-125 281;
-131 281;
-138 283;
-153 301;
-143 258;
-158 274;
-166 276;
-174 279;
-178 275;
-181 268;
-182 261;
-215 296;
-221 293;
-227 290;
-230 285;
-237 283;
-246 283;
-254 283;
-263 283;
-273 283;
-283 283;
-292 282;
-302 282;
-314 283;
-326 283;
-337 282;
-348 281;
-359 280;
-370 279;
-423 307;
-434 303;
-445 300;
-447 290;
-452 282;
-462 267;
-474 262;
-531 271;
-816 297;
-802 276;
-850 276;
-812 248;
-770 221;
-859 230;
-1036 258;
-730 168;
-939 199;
-1266 223;
-1238 196;
-1245 175;
-1225 150;
-1189 125;
-1164 101;
-1156 80;
-1138 59;
-1157 40;
-1124 19;
-1147 0;
-1215 -42;
-1212 -63;
-1212 -84;
-1208 -105;
-1207 -126;
-1216 -149;
-1212 -170;
-1194 -189;
-1207 -212;
-1204 -234;
-1210 -257;
-1194 -275;
-1194 -297;
-1207 -323;
-1191 -341;
-1205 -368;
-1197 -389;
-1195 -411;
-1199 -436;
-1196 -459;
-1193 -482;
-1199 -509;
-1196 -532;
-1179 -549;
-1190 -580;
-1182 -602;
-1181 -628;
-1174 -651;
-1180 -681;
-1176 -707;
-1185 -740;
-1179 -765;
-1192 -804;
-1143 -800;
-1097 -797;
-1105 -832;
-1118 -873;
-1124 -910;
-1122 -941;
-1114 -968;
-1119 -1008;
-993 -926;
-971 -937;
-934 -934;
-905 -938;
-863 -925;
-839 -931;
-803 -923;
-769 -916;
-751 -927;
-723 -925;
-689 -914;
-659 -907;
-642 -918;
-615 -912;
-586 -902;
-570 -913;
-545 -907;
-515 -892;
-514 -928;
-481 -905;
-459 -902;
-442 -907;
-417 -895;
-401 -902;
-382 -900;
-362 -896;
-342 -891;
-323 -888;
-300 -872;
-286 -882;
-272 -891;
-258 -902;
-245 -916;
-230 -925;
-217 -941;
-232 -1092;
-206 -1064;
-176 -1001;
-174 -1102;
-161 -1149;
-156 -1275;
-152 -1454;
-163 -1869;
-163 -2344;
-132 -2528;
-92 -2649;
-46 -2642;
0 -1603;
28 -1628;
52 -1494;
79 -1512;
108 -1556;
280 -3210;
217 -2071;
199 -1624;
235 -1677;
265 -1676;
305 -1731;
338 -1742;
367 -1728;
402 -1742;
313 -1256;
319 -1191;
734 -2561;
778 -2544;
909 -2798;
1071 -3110;
1403 -2080;
1408 -2011;
1465 -2017;
1679 -2228;
2036 -2606;
2028 -2504;
2029 -2419;
1686 -1939;
1980 -2199;
2012 -2158;
2006 -2078;
2009 -2009;
1943 -1876;
2009 -1874;
2011 -1811;
2029 -1764;
2020 -1695;
2034 -1647;
2033 -1588;
2040 -1537;
2043 -1484;
1993 -1197;
2000 -1155;
1981 -1098;
1988 -1057;
1980 -1009;
1976 -963;
1961 -914;
1988 -885;
1963 -833;
1963 -793;
1951 -748;
1957 -712;
3292 -1133;
3301 -1009;
3312 -949];
% Generate data points
a = readtable('graphXY1V.csv');
b = table2array(a);
c = b(1,:);
%data(1,:) = c(~isinf(c));
c = b(2,:);
%data(2,:) = c(~isinf(c));
model = [1147 0;
2038 35;
2036 71;
2019 105;
2032 142;
2018 176;
871 122;
596 126;
588 135;
581 144;
572 153;
534 153;
584 190;
590 203;
563 205;
553 212;
544 219;
539 228;
535 238;
532 248;
527 257;
521 265;
509 270;
492 272;
499 288;
453 272;
437 273;
423 275;
402 271;
388 271;
373 271;
360 271;
347 271;
335 271;
324 271;
312 271;
300 270;
291 271;
281 271;
272 272;
262 271;
253 272;
244 271;
236 272;
228 271;
220 272;
212 271;
205 272;
198 272;
190 271;
183 271;
176 271;
170 272;
163 272;
157 272;
151 272;
145 272;
138 272;
132 272;
127 272;
121 273;
115 272;
110 272;
104 272;
99 273;
94 273;
88 272;
83 273;
78 273;
73 274;
68 274;
63 274;
58 274;
53 274;
48 274;
43 274;
38 275;
33 274;
28 275;
24 275;
19 276;
14 277;
0 278;
-4 276;
-9 276;
-14 276;
-19 277;
-24 277;
-29 278;
-36 293;
-46 263;
-53 276;
-58 275;
-63 274;
-67 271;
-70 264;
-73 257;
-86 284;
-92 285;
-98 287;
-102 282;
-106 278;
-112 278;
-118 277;
-124 278;
-130 279;
-136 279;
-151 297;
-156 271;
-164 273;
-172 276;
-177 272;
-178 265;
-181 258;
-213 294;
-219 291;
-225 288;
-229 282;
-235 281;
-244 280;
-252 280;
-261 280;
-263 273;
-335 335;
-335 324;
-336 313;
-337 303;
-339 295;
-343 288;
-352 285;
-360 272;
-360 262;
-361 252;
-359 242;
-363 235;
-375 234;
-383 230;
-409 236;
-422 234;
-689 251;
-694 238;
-690 224;
-762 233;
-1058 303;
-685 183;
-885 220;
-897 207;
-837 177;
-1194 210;
-1189 188;
-1154 162;
-1019 125;
-1076 113;
-1077 94;
-1072 74;
-1064 55;
-1074 37;
-1060 18;
-1058 0;
-1105 -19;
-1090 -38;
-1099 -57;
-1103 -77;
-1119 -97;
-1093 -114;
-1108 -136;
-1088 -152;
-1107 -175;
-1100 -193;
-1108 -215;
-1100 -233;
-1107 -255;
-1097 -273;
-1107 -296;
-1103 -316;
-1086 -332;
-1098 -356;
-1090 -375;
-1099 -400;
-1088 -417;
-1112 -449;
-1100 -467;
-1099 -489;
-1102 -514;
-1097 -535;
-1109 -565;
-1089 -579;
-1098 -608;
-1102 -636;
-1077 -647;
-1090 -681;
-1093 -710;
-1091 -736;
-1078 -754;
-1085 -788;
-1051 -791;
-1010 -789;
-1011 -818;
-1045 -877;
-1043 -907;
-1041 -937;
-1031 -961;
-1025 -990;
-922 -922;
-884 -916;
-864 -927;
-823 -914;
-799 -919;
-771 -919;
-759 -938;
-721 -923;
-684 -908;
-663 -912;
-653 -933;
-607 -901;
-590 -909;
-567 -908;
-556 -926;
-528 -914;
-501 -905;
-491 -924;
-462 -907;
-448 -918;
-416 -893;
-401 -900;
-383 -903;
-364 -902;
-344 -897;
-322 -886;
-303 -881;
-285 -879;
-270 -885;
-253 -882;
-234 -876;
-218 -875;
-200 -870;
-186 -877;
-170 -879;
-155 -881;
-147 -932;
-132 -943;
-135 -1106;
-109 -1046;
-92 -1052;
-81 -1163;
-64 -1237;
-43 -2512;
0 -2637;
45 -2620;
92 -2652;
84 -1619;
109 -1566;
137 -1570;
155 -1475;
190 -1554;
458 -3264;
265 -1674;
293 -1662;
327 -1685;
354 -1666;
405 -1756;
438 -1760;
455 -1699;
503 -1756;
783 -2562;
389 -1197;
432 -1254;
640 -1373;
1931 -2658;
1934 -2566;
1763 -2256;
2117 -2615;
2119 -2525;
2092 -2407;
1747 -1940;
2065 -2214;
2091 -2165;
2091 -2091;
2096 -2024;
2029 -1892;
2106 -1896;
2086 -1813;
2092 -1755;
2119 -1716;
2106 -1645;
2116 -1594;
2109 -1532;
2115 -1481;
2117 -1428;
2100 -1213;
2116 -1173;
2082 -1107;
2092 -1066;
2079 -1014;
2061 -961;
2058 -916;
2050 -870;
2061 -832;
2059 -790;
2081 -757;
3384 -843;
3386 -781;
3414 -725;
3403 -661;
3393 -598;
3411 -540;
3365 -473;
3406 -418];

model = model';
data = data';
% A plot. Model points and data points in start positions
figure(1)
plot(model(1,:),model(2,:),'r.',data(1,:),data(2,:),'b.'), axis equal
% Running the ICP-algorithm. Least squares criterion
[RotMat,TransVec,dataOut]=icp(model,data,100,5,3,1e-10);
RotMat
TransVec
% A plot. Model points and data points in transformed positions
figure(2)
plot(model(1,:),model(2,:),'r.',dataOut(1,:),dataOut(2,:),'b.'), axis equal
